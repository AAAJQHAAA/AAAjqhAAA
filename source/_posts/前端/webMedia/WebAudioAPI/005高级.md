# 高级技术：创建和排序音频
- 在本教程中，我们将介绍声音的创建和修改，以及时间和调度。我们将介绍样品加载、包络、滤波器、波表和频率调制。如果您熟悉这些术语，并且正在寻找Web Audio API应用程序的介绍，那么您来对地方了。
- 注：你可以在GitHub上MDN的[webaudio-examples](https://github.com/mdn/webaudio-examples) repo的step-sequencer目录中找到下面演示的源代码。您还可以看到[现场演示](https://mdn.github.io/webaudio-examples/step-sequencer/)
# 演示
- 实际上，使用库更容易做到这一点--Web Audio API就是为了构建而构建的。如果你打算开始构建更复杂的东西，[tone.js](https://tonejs.github.io/)将是一个很好的起点。但是，我们想演示如何从基本原理创建这样的演示作为学习练习
- 该界面由主控件组成，允许我们播放/停止音序器，并调整BPM（每分钟节拍）以加快或减慢“音乐”
- 可以播放四种不同的声音或声音。每个声音有四个按钮，一个按钮对应一小节音乐中的每个节拍。当它们被启用时，音符将发出声音。当乐器演奏时，它会穿过这组节拍并在小节上循环
- 每个声音也有本地控制，允许您操纵特定于我们用于创建这些声音的每种技术的效果或参数。我们使用的方法是：
  - "Sweep"	振荡器，周期波
  - "Pulse"	多个振荡器
  - "Noise"	随机噪声缓冲器，双二阶滤波器
  - "Dial up"	正在加载要播放的声音样本
- 注意：我们创建这个乐器并不是为了听起来好，而是为了提供演示代码。这个演示是这种仪器的一个非常简化的版本。声音是基于拨号调制解调器。如果你不知道这样的设备听起来如何，你可以[在这里听一个](https://soundcloud.com/john-pemberton/modem-dialup)。
# 创建音频上下文
- `const audioCtx = new AudioContext();`
# “扫描”-振荡器、周期波和包络
- 对于我们称之为“扫频”的声音，当你拨号时听到的第一个噪音，我们将创建一个振荡器来产生声音。
- OscillatorNode具有开箱即用的基本波形-正弦、方波、三角波或正弦波。然而，我们将使用PeriodicWave接口和wavetable中的值来创建自己的wave，而不是使用默认的标准wave。我们可以使用PeriodicWave()构造函数将这个自定义wave与振荡器一起使用
## 周期波
- 首先，我们将创建周期波。为此，我们需要将真实的值和虚值传入PeriodicWave()构造函数
```
const wave = new PeriodicWave(audioCtx, {
  real: wavetable.real,
  imag: wavetable.imag,
});
```
- 注意：在我们的例子中，波表保存在一个单独的JavaScript文件（wavetable.js）中，因为有很多值。我们从一个[wavetables存储库](https://github.com/GoogleChromeLabs/web-audio-samples/tree/main/src/demos/wavetable-synth/wave-tables)中获取它，该存储库位于[Google Chrome Labs的Web Audio API示例](https://github.com/GoogleChromeLabs/web-audio-samples/)中。
## 振荡器
- 现在我们可以创建一个OscillatorNode并将其wave设置为我们创建的wave
```
function playSweep(time) {
  const osc = new OscillatorNode(audioCtx, {
    frequency: 380,
    type: "custom",
    periodicWave: wave,
  });
  osc.connect(audioCtx.destination);
  osc.start(time);
  osc.stop(time + 1);
}
```
- 我们在这里向函数传递一个时间参数，稍后我们将使用它来调度扫描
## 控制振幅
- 这很好，但如果我们有一个振幅包络来配合它，不是更好吗？让我们来创建一个简单的信封，以便熟悉使用Web Audio API创建信封所需的方法
- 假设我们的信封有攻击和释放。我们可以允许用户使用界面上的范围输入来控制这些
```html
<label for="attack">Attack</label>
<input
  name="attack"
  id="attack"
  type="range"
  min="0"
  max="1"
  value="0.2"
  step="0.1" />

<label for="release">Release</label>
<input
  name="release"
  id="release"
  type="range"
  min="0"
  max="1"
  value="0.5"
  step="0.1" />
```
- 现在我们可以在JavaScript中创建一些变量，并在输入值更新时更改它们：
```html
let attackTime = 0.2;
const attackControl = document.querySelector("#attack");
attackControl.addEventListener(
  "input",
  (ev) => {
    attackTime = parseInt(ev.target.value, 10);
  },
  false,
);

let releaseTime = 0.5;
const releaseControl = document.querySelector("#release");
releaseControl.addEventListener(
  "input",
  (ev) => {
    releaseTime = parseInt(ev.target.value, 10);
  },
  false,
);
```



