"use strict";(self["webpackChunkqjt"]=self["webpackChunkqjt"]||[]).push([[124],{7124:function(t,e,o){o.r(e),o.d(e,{default:function(){return w}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("div",{staticClass:"content"},[e("div",{staticClass:"image-select"},[e("div",{staticClass:"img-list"},t._l(t.imageUrlList,(function(o){return e("div",{staticClass:"img-item",class:{active:t.currentImgId==o.id},on:{click:function(e){return t.imgClick(o.id,o.imageURL)}}},[e("img",{staticClass:"img",attrs:{src:o.imageURL}}),e("div",{staticClass:"upload-name"},[t._v(t._s(o.name))])])})),0),e("div",{staticClass:"upload",on:{click:function(e){return t.$refs.fileUpload.click()}}},[e("img",{staticClass:"upload-img",attrs:{src:o(763)}}),e("div",{staticClass:"upload-name"},[t._v("上传图片")]),e("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{accept:"image/*",type:"file"},on:{change:function(e){return t.uploadFileChange()}}})])]),e("div",{staticClass:"center"},[e("div",{staticClass:"img-preview"},[e("Viewer",{ref:"viewImage",attrs:{hotSpots:t.currentHotSpots,autoRotate:t.defaultConfig.autoRotate}})],1)]),e("div",{staticClass:"right-attribute"},[e("el-form",{attrs:{"label-position":"top","label-width":"80px",model:t.defaultConfig}},[e("el-form-item",[e("el-switch",{attrs:{disabled:!t.currentImgId,"active-text":"自动旋转"},model:{value:t.defaultConfig.autoRotate,callback:function(e){t.$set(t.defaultConfig,"autoRotate",e)},expression:"defaultConfig.autoRotate"}})],1)],1),e("el-button",{attrs:{disabled:!t.currentImgId,size:"mini",round:""},on:{click:function(e){return t.addHotSpot(t.currentImgId)}}},[t._v("添加热点")]),t._l(t.currentHotSpots,(function(o){return e("div",[e("el-input",{attrs:{placeholder:"请输入内容"},model:{value:o.text,callback:function(e){t.$set(o,"text",e)},expression:"item.text"}})],1)}))],2)])])},n=[],r=(o(560),function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("div",{ref:"container",staticClass:"pnlm-container",attrs:{id:"container"}},[e("div",{ref:"uiControls",staticClass:"pnlm-ui"},[e("div",{ref:"dragControl",staticClass:"pnlm-dragfix"}),t._l(t.getHotSpots,(function(i){return e("div",{ref:i.id,refInFor:!0,staticClass:"hotspot-base",on:{mousedown:function(e){return t.hotspotDown(e,i)},mouseup:function(e){return t.hotspotUp(e,i)},mousemove:function(e){return t.hotspotMove(e,i)}}},[e("div",{staticClass:"tooltip-container"},[e("div",{staticClass:"tooltip"},[e("img",{attrs:{src:o(6146)}}),e("div",{staticClass:"tooltip-text"},[t._v(t._s(i.text))])])])])})),e("div",{ref:"compass",staticClass:"pnlm-compass"})],2)])])}),a=[];o(4224),o(1121),o(7133);let s=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),c=["precision highp float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image0;","uniform sampler2D u_image1;","uniform bool u_splitImage;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),h=c+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),u=c+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else {","if(u_splitImage) {","if(coord.x < 0.0)","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","else","gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","} else {","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}","}","}"].join("\n");function l(t){let e,o,i,n,r,a,l,A,d,m,f,g,v,p,E,w,P;function M(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function _(){console.log("由于错误1286，正在减少画布大小!"),e.width=Math.round(e.width/2),e.height=Math.round(e.height/2)}t&&(e=document.createElement("canvas"),e.style.width=e.style.height="100%",t.appendChild(e)),this.init=function(t,p,E,w){let D,x=360*Math.PI/180,I=180*Math.PI/180,R=0*Math.PI/180;if(void 0===p&&(p="equirectangular"),"equirectangular"!=p&&"cubemap"!=p)throw{type:"配置错误！"};g=p,f=t,P=w||{},o&&(n&&(i.detachShader(o,n),i.deleteShader(n)),r&&(i.detachShader(o,r),i.deleteShader(r)),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),o.texture&&i.deleteTexture(o.texture),i.deleteProgram(o),o=void 0),a&&(l&&(i.detachShader(a,l),i.deleteShader(l)),A&&(i.detachShader(a,A),i.deleteShader(A)),i.deleteProgram(a),a=void 0),m=void 0;let C,T=!1;if("cubemap"==g)for(D=0;D<6;D++)f[D].width>0?(void 0===C&&(C=f[D].width),C!=f[D].width&&console.log("立方体面具有不一致的宽度: "+C+" vs. "+f[D].width)):T=!0;function S(t){if(T){let e=t*t*4,o=new Uint8ClampedArray(e),i=w&&w.backgroundColor?w.backgroundColor:[0,0,0];i[0]*=255,i[1]*=255,i[2]*=255;for(let t=0;t<e;t++)o[t++]=i[0],o[t++]=i[1],o[t++]=i[2];let n=new ImageData(o,t,t);for(D=0;D<6;D++)0==f[D].width&&(f[D]=n)}}if("cubemap"==g&&0!==(C&C-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(i||(i=e.getContext("experimental-webgl",{alpha:!1,depth:!1})),i&&1286==i.getError()&&_()),!i)throw{type:"no WebGL support detected!"};"cubemap"==g&&S(C),f.basePath?f.fullpath=f.basePath+f.path:f.fullpath=f.path,f.invTileResolution=1/f.tileResolution;let U=M();for(d=[],D=0;D<6;D++)d[D]=U.slice(12*D,12*D+12),U=M();let b=0;if("equirectangular"==g){if(b=i.getParameter(i.MAX_TEXTURE_SIZE),Math.max(f.width/2,f.height)>b)throw{type:`图片太大${f.width}px 宽, 设备最大支持${2*b}px.`,width:f.width,maxWidth:2*b}}else if("cubemap"==g&&C>i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE))throw{type:`图片太大${C}px 宽, 设备最大支持${2*b}px.`,width:C,maxWidth:b};if(w){let t=isNaN(w.horizonPitchRadian)?0:Number(w.horizonPitchRadian),e=isNaN(w.horizonRollRadian)?0:Number(w.horizonRollRadian);0==t&&0==e||(m=[t,e])}let L=i.TEXTURE_2D;if(i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.getShaderPrecisionFormat){let t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&t.precision<1&&(c=c.replace("highp","mediump"))}n=i.createShader(i.VERTEX_SHADER);let y=s;i.shaderSource(n,y),i.compileShader(n),r=i.createShader(i.FRAGMENT_SHADER);let B=u;"cubemap"==g&&(L=i.TEXTURE_CUBE_MAP,B=h),i.shaderSource(r,B),i.compileShader(r),o=i.createProgram(),i.attachShader(o,n),i.attachShader(o,r),i.linkProgram(o),i.getShaderParameter(n,i.COMPILE_STATUS)||console.log(i.getShaderInfoLog(n)),i.getShaderParameter(r,i.COMPILE_STATUS)||console.log(i.getShaderInfoLog(r)),i.getProgramParameter(o,i.LINK_STATUS)||console.log(i.getProgramInfoLog(o)),i.useProgram(o),o.drawInProgress=!1;let F=w&&w.backgroundColor?w.backgroundColor:[0,0,0];if(i.clearColor(F[0],F[1],F[2],1),i.clear(i.COLOR_BUFFER_BIT),o.texCoordLocation=i.getAttribLocation(o,"a_texCoord"),i.enableVertexAttribArray(o.texCoordLocation),v||(v=i.createBuffer()),i.bindBuffer(i.ARRAY_BUFFER,v),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),i.STATIC_DRAW),i.vertexAttribPointer(o.texCoordLocation,2,i.FLOAT,!1,0,0),o.aspectRatio=i.getUniformLocation(o,"u_aspectRatio"),i.uniform1f(o.aspectRatio,i.drawingBufferWidth/i.drawingBufferHeight),o.psi=i.getUniformLocation(o,"u_psi"),o.theta=i.getUniformLocation(o,"u_theta"),o.f=i.getUniformLocation(o,"u_f"),o.h=i.getUniformLocation(o,"u_h"),o.v=i.getUniformLocation(o,"u_v"),o.vo=i.getUniformLocation(o,"u_vo"),o.rot=i.getUniformLocation(o,"u_rot"),i.uniform1f(o.h,x/(2*Math.PI)),i.uniform1f(o.v,I/Math.PI),i.uniform1f(o.vo,R/Math.PI*2),"equirectangular"==g&&(o.backgroundColor=i.getUniformLocation(o,"u_backgroundColor"),i.uniform4fv(o.backgroundColor,F.concat([1]))),o.texture=i.createTexture(),i.bindTexture(L,o.texture),"cubemap"==g)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[1]),i.texImage2D(i.TEXTURE_CUBE_MAP_NEGATIVE_X,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[3]),i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_Y,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[4]),i.texImage2D(i.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[5]),i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_Z,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[0]),i.texImage2D(i.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f[2]);else if(f.width<=b)i.uniform1i(i.getUniformLocation(o,"u_splitImage"),0),i.texImage2D(L,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,f);else{i.uniform1i(i.getUniformLocation(o,"u_splitImage"),1);let t=document.createElement("canvas");t.width=f.width/2,t.height=f.height;let e=t.getContext("2d");e.drawImage(f,0,0);let n=e.getImageData(0,0,f.width/2,f.height);i.texImage2D(L,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,n),o.texture2=i.createTexture(),i.activeTexture(i.TEXTURE1),i.bindTexture(L,o.texture2),i.uniform1i(i.getUniformLocation(o,"u_image1"),1),e.drawImage(f,-f.width/2,0),n=e.getImageData(0,0,f.width/2,f.height),i.texImage2D(L,0,i.RGB,i.RGB,i.UNSIGNED_BYTE,n),i.texParameteri(L,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(L,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(L,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(L,i.TEXTURE_MAG_FILTER,i.LINEAR),i.activeTexture(i.TEXTURE0)}"cubemap"!=g&&f.width&&f.width<=b&&x==2*Math.PI&&0==(f.width&f.width-1)?i.texParameteri(L,i.TEXTURE_WRAP_S,i.REPEAT):i.texParameteri(L,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(L,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(L,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(L,i.TEXTURE_MAG_FILTER,i.LINEAR);let k=i.getError();if(0!==k)throw{type:"Something went wrong with WebGL!"};E()},this.destroy=function(){if(void 0!==t&&void 0!==e&&t.contains(e)&&t.removeChild(e),i){let t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}},this.resize=function(){let t=window.devicePixelRatio||1;e.width=e.clientWidth*t,e.height=e.clientHeight*t,i&&(1286==i.getError()&&_(),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),f.shtHash?(i.useProgram(a),i.uniform1f(a.aspectRatio,e.clientWidth/e.clientHeight),i.useProgram(o)):i.uniform1f(o.aspectRatio,e.clientWidth/e.clientHeight))},e&&this.resize(),this.setPose=function(t,e){t=isNaN(t)?0:Number(t),e=isNaN(e)?0:Number(e),m=0==t&&0==e?void 0:[t,e]},this.getPose=function(){return m||[0,0]},this.render=function(t,n,r,s){let c,h=0;if(s||(s={}),s.roll&&(h=s.roll),void 0!==m){let e=m[0],o=m[1],i=t,r=n,a=Math.cos(o)*Math.sin(t)*Math.sin(e)+Math.cos(t)*(Math.cos(e)*Math.cos(n)+Math.sin(o)*Math.sin(e)*Math.sin(n)),s=-Math.sin(t)*Math.sin(o)+Math.cos(t)*Math.cos(o)*Math.sin(n),c=Math.cos(o)*Math.cos(e)*Math.sin(t)+Math.cos(t)*(-Math.cos(n)*Math.sin(e)+Math.cos(e)*Math.sin(o)*Math.sin(n));t=Math.asin(Math.max(Math.min(c,1),-1)),n=Math.atan2(s,a);let u=[Math.cos(i)*(Math.sin(o)*Math.sin(e)*Math.cos(r)-Math.cos(e)*Math.sin(r)),Math.cos(i)*Math.cos(o)*Math.cos(r),Math.cos(i)*(Math.cos(e)*Math.sin(o)*Math.cos(r)+Math.sin(r)*Math.sin(e))],l=[-Math.cos(t)*Math.sin(n),Math.cos(t)*Math.cos(n)],A=Math.acos(Math.max(Math.min((u[0]*l[0]+u[1]*l[1])/(Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])*Math.sqrt(l[0]*l[0]+l[1]*l[1])),1),-1));u[2]<0&&(A=2*Math.PI-A),h+=A}s.hook&&s.hook({gl:i,program:o,previewProgram:a,imageType:g,texCoordBuffer:v,cubeVertBuf:p,cubeVertTexCoordBuf:E,cubeVertIndBuf:w});let u=2*Math.atan(Math.tan(.5*r)/(i.drawingBufferWidth/i.drawingBufferHeight));if(c=1/Math.tan(.5*u),i.uniform1f(o.psi,n),i.uniform1f(o.theta,t),i.uniform1f(o.rot,h),i.uniform1f(o.f,c),i.drawArrays(i.TRIANGLES,0,6),void 0!==s.returnImage)return window.createImageBitmap&&"ImageBitmap"==s.returnImage?createImageBitmap(e):0==s.returnImage.toString().indexOf("image/")?e.toDataURL(s.returnImage):e.toDataURL("image/png")},this.getCanvas=function(){return e}}var A={name:"Viewer",props:{autoRotate:{type:Boolean,required:!0},hotSpots:{type:Array,default:function(){return[]}}},computed:{getHotSpots:function(){return this.hotSpots}},watch:{autoRotate(t,e){this.config.autoRotate=t,this.animate()},getHotSpots(t,e){console.log(t),this.$nextTick((()=>{this.renderHotSpots()}))}},data(){return{panoImage:null,renderer:null,animating:!1,defaultConfig:{minHfov:50,maxHfov:120,imageType:"equirectangular",origPitch:0,origYaw:0,origHfov:100,autoRotate:!1},config:{pitch:0,yaw:0,hfov:100,autoRotate:!1},pointer:{isUserDown:!1,onPointerDownPointerX:0,onPointerDownPointerY:0,onPointerDownYaw:0,onPointerDownPitch:0,onPointerDownPointerDist:-1},resizeObserver:null,moveHotspotId:null}},methods:{loadImage(t){let e=this;const o=new Image;o.crossOrigin="anonymous",o.onload=function(){e.init()},o.onerror=function(){console.log("panoImage加载失败！")},o.src=t||"building.jpg",this.panoImage=o},init(){let t,e=this;t=e.renderer?e.renderer:new l(document.getElementById("container")),t.init(this.panoImage,this.defaultConfig.imageType,(()=>{e.renderer=t,e.animate()}),null)},animate(){this.animating||(this.animating=!0,this.render())},render(){if(this.renderer){let{pitch:t,yaw:e,hfov:o}=this.config;e>360?e-=360:e<-360&&(e+=360),this.config.yaw=e,this.renderer.render(t*Math.PI/180,e*Math.PI/180,o*Math.PI/180,null),this.pointer.isUserDown?requestAnimationFrame(this.render):this.config.autoRotate?(this.config.yaw+=.1,requestAnimationFrame(this.render)):this.animating=!1,this.renderHotSpots();const i=this.$refs.compass;i.style.transform="rotate("+(-e-0)+"deg)",i.style.webkitTransform="rotate("+(-e-0)+"deg)"}},renderHotSpots(){this.hotSpots.forEach(this.renderHotSpot)},renderHotSpot(t){const{id:e,pitch:o,yaw:i}=t,n=this.$refs[e][0];let{pitch:r,yaw:a,hfov:s}=this.config,c=Math.sin(o*Math.PI/180),h=Math.cos(o*Math.PI/180),u=Math.sin(r*Math.PI/180),l=Math.cos(r*Math.PI/180),A=Math.cos((-i+a)*Math.PI/180),d=c*u+h*A*l;if(i<=90&&i>-90&&d<=0||(i>90||i<=-90)&&d<=0)n.style.visibility="hidden";else{let t=Math.sin((-i+a)*Math.PI/180),e=Math.tan(s*Math.PI/360);n.style.visibility="visible";let o=this.renderer.getCanvas(),r=o.clientWidth,m=o.clientHeight,f=[-r/e*t*h/d/2,-r/e*(c*l-h*A*u)/d/2],g=Math.sin(0),v=Math.cos(0);f=[f[0]*v-f[1]*g,f[0]*g+f[1]*v],f[0]+=(r-n.offsetWidth)/2,f[1]+=(m-n.offsetHeight)/2;let p="translate("+f[0]+"px, "+f[1]+"px) translateZ(9999px)";n.style.webkitTransform=p,n.style.MozTransform=p,n.style.transform=p}},domEventAdd(){const{container:t,uiControls:e,dragControl:o}=this.$refs;if(e.addEventListener("mousewheel",this.onDocumentMouseWheel,!1),e.addEventListener("DOMMouseScroll",this.onDocumentMouseWheel,!1),o.addEventListener("mousedown",this.onDocumentMouseDown,!1),o.addEventListener("mousemove",this.onDocumentMouseMove,!1),o.addEventListener("mouseup",this.onDocumentMouseUp,!1),o.addEventListener("mouseleave",this.onDocumentMouseUp,!1),o.addEventListener("touchstart",this.onDocumentTouchStart,!1),o.addEventListener("touchmove",this.onDocumentTouchMove,!1),o.addEventListener("touchend",this.onDocumentTouchEnd,!1),o.addEventListener("dblclick",this.onDocumentDoubleClick,!1),t.addEventListener("mozfullscreenchange",this.onDocumentResize,!1),t.addEventListener("webkitfullscreenchange",this.onDocumentResize,!1),t.addEventListener("msfullscreenchange",this.onDocumentResize,!1),t.addEventListener("fullscreenchange",this.onDocumentResize,!1),"function"===typeof ResizeObserver){const e=new ResizeObserver(this.onDocumentResize);e.observe(t),this.resizeObserver=e}else window.addEventListener("resize",this.onDocumentResize,!1),window.addEventListener("orientationchange",this.onDocumentResize,!1)},onDocumentMouseWheel(t){if(!this.renderer)return;t.preventDefault();const{pitch:e,yaw:o,hfov:i}=this.config;t.wheelDeltaY?this.config.hfov=this.calcHfov(i-.05*t.wheelDeltaY):t.wheelDelta?this.config.hfov=this.calcHfov(i-.05*t.wheelDelta):t.detail&&(this.config.hfov=this.calcHfov(i+1.5*t.detail)),this.animate()},calcHfov(t){const{minHfov:e,maxHfov:o}=this.defaultConfig;return t<e?e:t>o?o:t},onDocumentMouseDown(t){const{container:e,uiControls:o}=this.$refs;if(o.style.cursor="move",t.preventDefault(),e.focus(),!this.renderer)return;let[i,n]=this.calcMousePosition(t);const{pitch:r,yaw:a}=this.config;this.pointer.isUserDown=!0,this.pointer.onPointerDownPointerX=i,this.pointer.onPointerDownPointerY=n,this.pointer.onPointerDownYaw=a,this.pointer.onPointerDownPitch=r,this.animate()},onDocumentMouseMove(t){if(!this.renderer||!this.pointer.isUserDown)return;const e=this.renderer.getCanvas();let o=e.clientWidth,i=e.clientHeight;const[n,r]=this.calcMousePosition(t),{onPointerDownPointerX:a,onPointerDownPointerY:s,onPointerDownYaw:c,onPointerDownPitch:h}=this.pointer,{hfov:u}=this.config;this.config.yaw=180*(Math.atan(a/o*2-1)-Math.atan(n/o*2-1))/Math.PI*u/90+c;let l=2*Math.atan(Math.tan(u/360*Math.PI)*i/o)*180/Math.PI;this.config.pitch=180*(Math.atan(r/i*2-1)-Math.atan(s/i*2-1))/Math.PI*l/90+h},onDocumentMouseUp(t){const{uiControls:e}=this.$refs;e.style.cursor="default",this.pointer.isUserDown=!1},onDocumentTouchStart(t){if(!this.renderer)return;let[e,o]=this.calcMousePosition(t.targetTouches[0]),i=e,n=o;if(2==t.targetTouches.length){let[r,a]=this.calcMousePosition(t.targetTouches[1]);i+=.5*(r-e),n+=.5*(a-o),this.pointer.onPointerDownPointerDist=Math.sqrt((e-r)*(e-r)+(o-a)*(o-a))}const{pitch:r,yaw:a}=this.config;this.pointer.isUserDown=!0,this.pointer.onPointerDownPointerX=i,this.pointer.onPointerDownPointerY=n,this.pointer.onPointerDownYaw=a,this.pointer.onPointerDownPitch=r,this.animate()},onDocumentTouchMove(t){if(!this.renderer||!this.pointer.isUserDown)return;const{hfov:e}=this.config,{onPointerDownPointerX:o,onPointerDownPointerY:i,onPointerDownYaw:n,onPointerDownPitch:r,onPointerDownPointerDist:a}=this.pointer;let[s,c]=this.calcMousePosition(t.targetTouches[0]),h=s,u=c;if(2==t.targetTouches.length&&-1!=a){let[o,i]=calcMousePosition(t.targetTouches[1]);h+=.5*(o-s),u+=.5*(i-c);let n=Math.sqrt((s-o)*(s-o)+(c-i)*(c-i));this.config.hfov=this.calcHfov(e+.1*(a-n)),this.pointer.onPointerDownPointerDist=n}this.config.yaw=e/360*(o-h)*2+n,this.config.pitch=e/360*(u-i)*2+r},onDocumentTouchEnd(){this.pointer.onPointerDownPointerDist=-1,this.pointer.isUserDown=!1},calcMousePosition(t){const{container:e}=this.$refs;let o=e.getBoundingClientRect(),i=(t.clientX||t.pageX)-o.left,n=(t.clientY||t.pageY)-o.top;return[i,n]},onDocumentDoubleClick(t){if(!this.renderer)return;const{minHfov:e,origHfov:o}=this.defaultConfig,{hfov:i}=this.config;if(e===i)this.config.hfov=o;else{let[o,i]=this.mouseEventToCoords(t);this.config.pitch=o,this.config.yaw=i,this.config.hfov=e}this.render()},mouseEventToCoords(t){let[e,o]=this.calcMousePosition(t),i=this.renderer.getCanvas(),n=i.clientWidth,r=i.clientHeight;e=e/n*2-1,o=(1-o/r*2)*r/n;let{pitch:a,yaw:s,hfov:c}=this.config,h=1/Math.tan(c*Math.PI/360),u=Math.sin(a*Math.PI/180),l=Math.cos(a*Math.PI/180),A=h*l-o*u,d=Math.sqrt(e*e+A*A);return a=180*Math.atan((o*l+h*u)/d)/Math.PI,s=180*Math.atan2(e/d,A/d)/Math.PI+s,s<-180&&(s+=360),s>180&&(s-=360),[a,s]},onDocumentResize(){this.renderer&&this.renderer.resize()},isFullscreenActive(){return!!(document.fullscreenElement||document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement)},toggleFullscreen(){try{if(this.renderer)if(this.isFullscreenActive())document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else{const{container:t}=this.$refs;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen()}}catch(t){console.error("全屏问题：",t)}},hotspotDown(t,e){this.moveHotspotId=e.id},hotspotMove(t,e){if(this.moveHotspotId==e.id){let o=this.mouseEventToCoords(t);e.pitch=o[0],e.yaw=o[1],this.renderHotSpot(e)}},hotspotUp(t,e){this.moveHotspotId=null}},destroyed(){try{this.renderer&&this.renderer.destroy();const{container:t,uiControls:e,dragControl:o}=this.$refs;e.removeEventListener("mousewheel",this.onDocumentMouseWheel,!1),e.removeEventListener("DOMMouseScroll",this.onDocumentMouseWheel,!1),o.removeEventListener("mousedown",this.onDocumentMouseDown,!1),o.removeEventListener("mousemove",this.onDocumentMouseMove,!1),o.removeEventListener("mouseup",this.onDocumentMouseUp,!1),o.removeEventListener("mouseleave",this.onDocumentMouseUp,!1),o.removeEventListener("touchstart",this.onDocumentTouchStart,!1),o.removeEventListener("touchmove",this.onDocumentTouchMove,!1),o.removeEventListener("touchend",this.onDocumentTouchEnd,!1),o.removeEventListener("dblclick",this.onDocumentDoubleClick,!1),t.removeEventListener("mozfullscreenchange",this.onDocumentResize,!1),t.removeEventListener("webkitfullscreenchange",this.onDocumentResize,!1),t.removeEventListener("msfullscreenchange",this.onDocumentResize,!1),t.removeEventListener("fullscreenchange",this.onDocumentResize,!1),"function"===typeof ResizeObserver?this.resizeObserver.disconnect():(window.removeEventListener("resize",this.onDocumentResize,!1),window.removeEventListener("orientationchange",this.onDocumentResize,!1))}catch(t){}},mounted(){this.domEventAdd()}},d=A,m=o(1001),f=(0,m.Z)(d,r,a,!1,null,"1760afda",null),g=f.exports,v={name:"EditPage",components:{Viewer:g},data(){return{funTabActive:"global",currentImgId:null,imageUrlList:[],defaultConfig:{pitch:0,yaw:0,hfov:100,autoRotate:!1},hotSpots:{},currentHotSpots:[]}},methods:{funTabToggle(t){this.funTabActive=t},uploadFileChange(){let t=this;const e=this.$refs.fileUpload;let o=e.files[0];if(e.value="",o){const e=new FileReader;e.onload=function(){const i=e.result;let n={id:t.generateUUID(),imageURL:i,name:o.name};t.imageUrlList.push(n),t.imgClick(n.id,n.imageURL)},e.readAsDataURL(o)}},generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0,o="x"===t?e:3&e|8;return o.toString(16)}))},imgClick(t,e){this.currentImgId=t,this.$refs.viewImage.loadImage(e),this.currentHotSpots=this.hotSpots[t]?this.hotSpots[t]:[]},addHotSpot(t){const{pitch:e,yaw:o}=this.$refs.viewImage.config;this.hotSpots[t]||(this.hotSpots[t]=[]),this.hotSpots[t].push({id:this.generateUUID(),pitch:e,yaw:o,text:"我是热点"}),this.currentHotSpots=this.hotSpots[t]}}},p=v,E=(0,m.Z)(p,i,n,!1,null,"cb77812a",null),w=E.exports},763:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwAQMAAABtzGvEAAAABlBMVEUAAAD///+l2Z/dAAAAAXRSTlMAQObYZgAAADpJREFUGNNjYMAD+P////8BFwWUx0d9/oCgbNCoDwiK+f8BnBSqSjSKgVgK5FwcFBggKDRP4PE8bgAAmwZrC6CKbWEAAAAASUVORK5CYII="},6146:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAAXNSR0IArs4c6QAAAs1QTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAm5ubAAAAgICAAAAAAAAAAAAAAAAAAAAAAAAAZ2dnAAAAAAAAAAAAAAAAAAAAAAAAAAAAV1dXAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlJSUAAAAAAAAAAAAAAAAAAAA19fXAAAAAAAAAAAAAAAAAAAAAAAAAAAALCws4uLi1tbWAAAAKysrVVVVJCQkgICAhYWFAAAArKysYWFhYmJiZWVlaGho4+PjAAAAj4+PVFRUlpaW5eXlvLy86enp7u7u8vLysrKycXFxcXFx0tLS5ubm29vbvLy8////////////////6urq////////////6Ojo6enp8PDw////////7e3t////////////8fHx9PT0/////Pz8////////39/f////+vr6/////Pz8////+Pj4/v7+////+fn5////+fn5/Pz8////////////+Pj4+/v7/Pz8////////9vb2+/v7////////9/f3+/v7////+fn59/f3////////9fX1+/v7////+Pj4+vr6/////////Pz8////+vr6/////Pz8/////Pz8////+/v7/////////////////v7+////+vr6/////Pz8/v7+/////////////////v7+/////////////////////////////////v7+/////v7+/////////////////v7+////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0uNUQQAAAO90Uk5TAAECAwQFBgcICQoLDA0PEBESExQVFhcYGRobHB4fICEhIiIjJCUmKCoqKywtLjAxMjIzNDU2Nzk7PD0+PkBBQkVGRkdISUpQUVVWV1hZWlpcXFxfX2RlZWVmaWltcHV2dnZ2d3h6goKFiIyNjo+SkpWYmZqam56foKGio6SkpqanqKipqaurrKysra2urq6vsLGxsbGys7OztLW1tba3t7i5ubm6u7u8vb2+vr+/wcHCw8TFxsfHycnKysrLzM3Ozs/Q0dLT1NXW1tfX2Nna29vc3d7f4eLj5OXm5+jp6uvs7e/w8fL09fb3+Pn6/P5w31aiAAAErklEQVRYw+1XzY8UVRCveq97ZnZm2F1m3V0kGISBECWaaKImJhIl3jhwkBjDnkw4kZgYT3rw7sU/wHDwxNGDiV7x44JAJBGyKrDyEWFhl2Vm+mN6+uNVlYfulene7mHjkVi3V931e79fvXr13gP4354Cw+19lP8AgIAIiAAgAiJVGFgdjUopRAQRYWapwLDK4xGV1vNHXzu0cy/c6V+7dO4hEZciYOn0Smn7yIfvjPl++PrnhJi3QmDZ9Erbr3/6KgCkcyIgAFz+4mJCLEUEXRKv7dqJr3YJUypdmJkBdp1YvV6yHLosvvH5J0LEMmbMAu/uPC9PZqC03fhsSYikYCzw0swvUoQoAqC2G8c/FsOyxZjx5XsrPBkA0aq99aUYkhJjwaNX7jJPqgPUduMUkykvLxJ96iIzSSUDVFb92Accbc6JSlsaQTYFkdp1d4VyFFQBwG4sScyZKVujCGpbbXpiWWrYCqskIGqr26UkG9maz94dQmvPkoYkpc26213WjFKRA9S1w2woHdh445t+bMDr/f1eF7O0JNbhG7GpkoBK20c4McYYY0D7Z+95juM43r2zvobUm/ARW49ryDNQVkM4SSXU+czDIBgyqFaTz3ykRxkvaQSqIgeISlsHOEoFon/Ld9zIgBVM8y3GVBg3Dlha4eMkFJNoNzlVqPmP0BsEMYFOWNm/vgIZQtPWiJWroBRDCoBMURhGMYMSFUbEGTCDUpUAgIjXu5AAACAZihJDAmKSiAyZBACgRn/heHyhkABgg9kYY0zAB4WzdiosBzkwxhhDvFHYvbmRiNzhrOyi5l6FWWtWe5tRVpx8J7+hVT6euU9IRETk0smOpZVSSludk+SmXqQ+53Z0AYCSDdJpyQzD+fcXajXLqtUWTs8Hw9SraSOhcQArT4DMqttOswiP5t/c9+2FHnTeOP4s9VOfDe6qybVWLBTi9OLbx/xettXnGgDLcBggfJTtj077+x/X3NBw+TIKkwlv8lS2Wcxqa0f9BaDIG27+McU3Q0MsVXUgFMcPlg81+9k46kF9vD3tpGsP4jjXkazCKphRfPlge+2xLx7/oc2X45FhqWbAlIxu31+YXS/tiQt4//YoySko9kREVas5L9bXibcaPAffrXt+PKGpAoJSttG7px6VADxfu7TsumEygUHamO2g2wqDLcfC7Lz/08D1IyMTTyZEZSlvX2vDFOZX++DcquOO8gRKTmcAtJNkd6uXP91wv31pxe0PCwRKJACi0kNrsT7I+fdP/XnVcbyoQKCEgQCgtpzdbeOPCZibdc57jhPEBQKlEgBAY78zx8G/42cWBxd67mAYGd4WgKDm4Z5mEmbj2cXe1XXP8cKigHIAAWBQZm16mkciIjLTcX576A7cMF9DkxgIA4ozO2NiFpzt+Ff6zsAdxSTbB2BAcdszeqjmdji/952BE8RbElCdxAzBt3Y0W7WNlUFlfBVAhgC+buPaLa86vhIgRQB0lHtz5DiV8dUAIMIsAm5/5DluZXzFZRsAhA0Am7AOUeCHlfHVACBsQCi0wERxUhk/8cWCSmtLARuiyvgnPHlQKQThrXf0bQJkF32Z8GTaxqsMn/qH5z+XoLBMiZvyDgAAAABJRU5ErkJggg=="}}]);
//# sourceMappingURL=124.da975be8.js.map